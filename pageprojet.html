<DOCTYPE html>

<script src="leaflet.js"> </script>

<html>

 <head>
  <title>Hydrométrie des rivières bretonnes</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">  
  <link rel="stylesheet" type="text/css" href="style3.css"/>
  <link rel="stylesheet" type="text/css" href="leaflet.css" />
  <link href="layout.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="jquery-ui/jquery-ui.css">
  <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="flot/excanvas.min.js"></script><![endif]-->
  <script language="javascript" type="text/javascript" src="jquery-1.12.4.js"></script>
  <script language="javascript" type="text/javascript" src="jquery-ui.js"></script>
  <script language="javascript" type="text/javascript" src="flot/jquery.flot.js"></script>

  
  <script>
  $( function() {
	var availablestations = [ "Lala", "Lalala", "Lalalale" ];
	$( "#stations" ).autocomplete({
		source: availablestations
	} );
  } );
  </script>
  
 </head>
 
 <body onload="load_data();"> 
  <h1>Hydrométrie des rivières bretonnes</h1>
  
  <div id="map"></div>
  <p/>
  
  <div id="description"></div>
  
  <div id="courbe" style="width:42vw;height:60vh;"></div>
  
  <div class="ui-widget">
  <label for="stations">Stations: </label>
  <input id="stations">
  </div>
  
 </body>
 
</html>

<script>

 var map = L.map('map').setView([48.4,-2.917], 8);

 L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);
 		
 function load_data () {
 var xhr = new XMLHttpRequest();
 xhr.onload = function() {
   	var data = JSON.parse(this.responseText);
     for ( n = 0; n < data.length; n++ ) {
	  L.marker([data[n].lat,data[n].lon]).addTo(map)
        .bindPopup('Lieu = '+data[n].name)
		.addEventListener('click',OnMarkerClick)
		.idnum=data[n].id; 
	  }
  };
 xhr.open('GET','/location',true);
 xhr.send();
 }

 function OnMarkerClick (e) {
 var xhr = new XMLHttpRequest();
 xhr.onload = function() {
	var data = JSON.parse(this.responseText);
	description.innerHTML =  '<b><i>' + e.target.getPopup().getContent() + '</i></b><br>'+ data.desc;
	var name = data.id;
	$(function () {
		var d2 = [{ data: [[0, 3], [4, 8], [8, 5], [9, 13]], label: name, color: "#333" }];
		var options = {
			lines: { show: true },
			points: { show: true }
		};
		$.plot($("#courbe"), d2, options);
	});
};

 xhr.open('GET','/description/'+e.target.idnum,true);
 xhr.send();
 }
</script>